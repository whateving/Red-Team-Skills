# Roundcube Webmail ‚Äî CVE-2025-49113

Roundcube is a free and open-source webmail project. It is very feature-rich and available in over eighty languages. Although its built-in features are rich, they can be further expanded through the support of third-party plug-ins.

It mainly requires a web server with PHP support and an SQL server to run. Apache, Nginx, and Lighttpd, among others, can easily satisfy the web server requirements; MySQL, MariaDB, PostgreSQL, SQLite, and many others can satisfy the database requirements. This versatility makes Roundcube a very popular choice for webmail, especially among hosting providers.

Recently, a vulnerability was discovered in Roundcube Webmail; it affects all versions 1.5.x and 1.6.x before 1.5.10 and 1.6.11. This vulnerability allows remote code execution (RCE) by authenticated users; in other words, valid credentials for the webmail are enough for the attacker to execute commands on the host system. This vulnerability has a CVSS 3.x severity score of 9.9, i.e., critical. Roundcube has already released versions 1.5.10 and 1.6.11 and strongly recommends updating.

---

## Serialization & Deserialization


The provided text explains serialization, deserialization, and the nature of a deserialization vulnerability, using a specific flaw in Roundcube Webmail as a real-world example.

### üíæ Serialization and Deserialization

These two processes are essential for managing objects outside of a program's immediate memory.

| Process | Description | Purpose |
|--------|-------------|---------|
| **Serialization** | The process of converting a program object (an instance of a class in languages like PHP, Java, or Python) into a sequential, flat format. | To make the object storable (e.g., saving it to a file or database) or transmittable (e.g., sending it over a network via an API or storing it in a cookie). |
| **Deserialization** | The inverse process: converting the flat, serialised data (e.g., a byte stream or a string) back into a fully functional program object within an application. | To restore the object's state and data for use by the running program. |

---

## ‚ö†Ô∏è Deserialization Vulnerability

A deserialization vulnerability is a severe security flaw that arises when an application attempts to convert untrusted or manipulated serialised data back into an object.

### üî• The Attack Vector

**The Problem:**  
When an object is deserialized, the programming language (e.g., PHP, Java) reconstructs the object, which often triggers specific methods within the object's class (like constructors or magic methods).

**The Exploitation:**  
An attacker doesn't need to attack the deserialization process itself; they manipulate the data before it's deserialized. They craft a serialised string that, when processed, creates an object whose inherent methods contain malicious code (a payload).

**The Result:**  
If the application doesn't strictly validate the data before deserialization, the malicious object is created, and its dangerous methods are executed, potentially leading to arbitrary code execution (ACE) or privilege escalation.

---

## üìß Example: Roundcube Webmail Flaw

<img width="621" height="234" alt="image" src="https://github.com/user-attachments/assets/37d172ea-b761-40d0-86f7-6131d801f483" />


The text cites a deserialization vulnerability discovered by Kirill Firsov in Roundcube Webmail as a concrete illustration.

**Vulnerable Component:** `upload.php`  
**The Flaw:**  
A specific URL parameter named `_from` was not thoroughly checked for safe values before its contents were deserialized. This allowed an attacker to input a malicious serialised string into the `_from` parameter.

**The Fix:**  
Seen in the commit logs for versions 1.5.10 and 1.6.11, the developers added new code to check whether `_from` contains unsafe characters before deserialization.

---

# Exploitation

First, we download the following PoC:

https://github.com/fearsoff-org/CVE-2025-49113/blob/main/CVE-2025-49113.php


<img width="621" height="234" alt="image" src="https://github.com/user-attachments/assets/fba84c97-9a74-4219-af91-964b3e402783" />


This code is a Proof-of-Concept (PoC) exploit script written in PHP. Its purpose is to demonstrate a severe security vulnerability, CVE-2025-49113, in the Roundcube Webmail application.

The core vulnerability it exploits is a Post-Authentication Remote Code Execution (RCE) via PHP Object Deserialization. After logging in, an attacker can trick the application into running arbitrary commands on the server by submitting specially crafted, serialized data.

Due to safety guidelines, the following explanation focuses on defensive understanding of the exploit flow.

---

# üîé Code Breakdown and Execution Flow

The script is executed from the command line and follows a clear, multi-step process defined in the main function.

---

## 1. Setup and Input Validation  
Functions: **main**, **validateUrl**

- Checks that URL, username, password, and command are provided.
- Assigns arguments to variables.
- Validates URL formatting.

<img width="621" height="395" alt="image" src="https://github.com/user-attachments/assets/b84db783-6046-4952-b327-20415465a72e" />


## 2. Authentication Stage

### `fetchCsrfTokenAndCookie`
- Sends a GET request to the login page.  
- Extracts CSRF token.  
- Retrieves initial session cookie.

<img width="621" height="395" alt="image" src="https://github.com/user-attachments/assets/bf53fce2-6b1e-4e2f-8ac3-ec1b16635957" />


### `authenticate`
- Sends POST login request with credentials.  
- Verifies login via HTTP 302 redirect.  
- Returns authenticated session cookie.

<img width="621" height="395" alt="image" src="https://github.com/user-attachments/assets/add963aa-285c-4be1-99da-b34409d72d77" />

---

## 3. Payload Generation and Preparation

### `calcPayload($cmd)`
- Creates a payload object using class **Crypt_GPG_Engine**.  
- Uses `serialize()` to create serialized PHP object.  
- The destructor triggers execution of the attacker's command.  
- Calls **process_serialized** to adjust serialized data.  
- Returns manipulated strings: **`$_from` and `$_file`**

These are crafted to exploit Roundcube's unsafe handling of serialized values.

<img width="621" height="395" alt="image" src="https://github.com/user-attachments/assets/be224c8f-d303-440a-ae9f-d1a2f737066a" />


---

## 4. Injection and Execution Stage

### `injectPayload`
- Sends multipart POST upload request.  
- Embeds malicious `_from` parameter into the URL.  
- Roundcube stores serialized data into session.

<img width="621" height="395" alt="image" src="https://github.com/user-attachments/assets/151b470d-e646-4fcb-a24e-981c15356e50" />


### `executePayload`
- Sends logout request or cleanup trigger.  
- Forces Roundcube to deserialize corrupted session data.  
- This executes the attacker's command.

<img width="621" height="395" alt="image" src="https://github.com/user-attachments/assets/ac9ffcdf-b6df-46b1-a804-17873ad7a746" />


---

# PoC Execution

<img width="627" height="336" alt="image" src="https://github.com/user-attachments/assets/3f3d1c91-c3e5-426f-be44-46b59449f6a4" />
<img width="627" height="336" alt="image" src="https://github.com/user-attachments/assets/8cb33d04-67aa-4806-a4dd-2202cdefa14f" />
<img width="627" height="336" alt="image" src="https://github.com/user-attachments/assets/385f4ee6-f514-4352-82a6-c1d2f92e9dd6" />




Eventhough we got an error, the bind shell is still working.

We were able to run:

cat /etc/passwd
cat /etc/flag.txt

<img width="627" height="336" alt="image" src="https://github.com/user-attachments/assets/d31f5187-53a7-4b6e-8e36-9a65218adcb5" />


---

# Mitigation

The exploit can be tricky to detect, considering it can easily pass as regular traffic. Considering the severity of the exploit:

### ‚úî Recommended: Update  
- Update to **1.5.10** and **1.6.11**

### ‚úî If updating is not possible  
- Block `upload.php`  
- Limit access to Roundcube via VPN  
- Apply WAF filtering  
- Monitor suspicious `_from` parameter values

---

# END OF FILE
